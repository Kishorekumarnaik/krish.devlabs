<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Community Q&A - KrishDevLabs</title>
    <link rel="canonical" href="https://krishdevlabs.xyz/Questions-Answers.html" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet" />
  <style>
    body {
      font-family: 'Inter', sans-serif;
      background: #f9f9fb;
      margin: 0;
    }
    .container {
      max-width: 800px;
      margin: 2rem auto;
      padding: 1rem;
    }
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
    }
    h1 {
      color: #7c3aed;
    }
    .navbar {
  background: #7c3aed;
  color: #fff;
  padding: 10px 12px; /* Reduced from 15px */
  display: flex;
  align-items: center;
  justify-content: space-between;
  position: relative;
}
.navbar h2 {
  font-size: 18px;      /* Slightly smaller */
  margin: 0;            /* Remove extra margin */
}
.menu-icon {
  font-size: 22px;
  cursor: pointer;
  margin-left: 8px;     /* Optional: reduce left spacing */
}
.sidebar {
  position: fixed;
  top: 0;
  left: -220px; /* hidden initially */
  width: 220px;  /* updated smaller width */
  height: 100%;
  background-color: #7c3aed; /* purple shade */
  transition: left 0.3s ease;
  z-index: 1000;
  padding-top: 70px; /* space below navbar */
}

.sidebar ul {
  list-style: none;
  padding: 0 20px;
  margin: 0;
}

.sidebar ul li {
  margin-bottom: 20px;
}

.sidebar ul li a {
  color: white;
  text-decoration: none;
  font-size: 17px;
  font-weight: 500;
  display: block;
}

.sidebar ul li a:hover {
  text-decoration: underline;
}

/* Sidebar open state */
.sidebar.open {
  left: 0;
}
    .menu-icon {
      font-size: 24px;
      cursor: pointer;
    }
    .overlay {
      position: fixed;
      top: 0;
      left: 0;
      height: 100%;
      width: 100%;
      background: rgba(0, 0, 0, 0.4);
      display: none;
      z-index: 2;
    }
    .overlay.show {
      display: block;
    }
    .btn {
      background: #7c3aed;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 500;
    }
    .question-card {
      background: #fff;
      border: 1px solid #ddd;
      padding: 1rem;
      border-radius: 10px;
      margin-bottom: 1rem;
    }
    .meta {
      font-size: 12px;
      color: #666;
      margin-bottom: 6px;
    }
    .answer {
      background: #f1f1f7;
      margin-top: 0.5rem;
      padding: 0.7rem;
      border-radius: 8px;
    }
    .answer-form {
      margin-top: 0.5rem;
      display: flex;
      gap: 8px;
    }
    .answer-form input {
      flex: 1;
      padding: 0.6rem;
      border: 1px solid #ccc;
      border-radius: 6px;
    }
    .toggle {
      cursor: pointer;
      font-size: 14px;
      margin-top: 6px;
      color: #6b21a8;
    }
    .actions {
      margin-top: 6px;
    }
    .actions button {
      background: none;
      border: none;
      color: #7c3aed;
      font-size: 12px;
      margin-right: 6px;
      cursor: pointer;
    }

    /* Modal */
    .modal-overlay {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.4);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 10;
    }
    .modal-overlay.show {
      display: flex;
    }
    .modal {
      background: white;
      padding: 20px;
      border-radius: 10px;
      width: 90%;
      max-width: 400px;
      position: relative;
    }
    .modal textarea {
      width: 100%;
      padding: 10px;
      margin-top: 10px;
      font-size: 14px;
      border: 1px solid #ccc;
      border-radius: 6px;
    }
    .modal-buttons {
      display: flex;
      justify-content: flex-end;
      margin-top: 10px;
      gap: 8px;
    }
    .modal .close-icon {
      position: absolute;
      right: 10px;
      top: 10px;
      cursor: pointer;
      font-size: 20px;
      color: #666;
    }
  </style>
</head>
<body>
 <!-- Sidebar -->
<div class="sidebar" id="sidebar">
  <ul>
    <li><a href="dashboard.html">Dashboard</a></li>
    <li><a href="Community.html">Discussions</a></li>
    <li><a href="Questions-Answers.html">Questions & Answers </a></li>
    <li><a href="/account.html">My Account</a></li>
  </ul>
</div>
  <!-- Overlay -->
  <div class="overlay" id="overlay" onclick="closeSidebar()"></div>

  <div class="navbar">
  <h2>Community Q&A</h2>
  <div class="menu-icon" onclick="toggleSidebar()">☰</div>
</div>

  <!-- Main Container -->
  <div class="container">
    <div class="header">
      <h1>All Questions</h1>
      <button class="btn" onclick="openModal()">+ New Post</button>
    </div>
    <div id="questionsList"></div>
  </div>

  <!-- Modal -->
  <div class="modal-overlay" id="modalOverlay">
    <div class="modal">
      <div class="close-icon" onclick="closeModal()">❌</div>
      <h3>Post a New Question</h3>
      <textarea id="newQuestionInput" placeholder="Write your question..."></textarea>
      <div class="modal-buttons">
        <button onclick="closeModal()">Cancel</button>
        <button onclick="postQuestion()" class="btn">Post</button>
      </div>
    </div>
  </div>

  <!-- Firebase and App Logic -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-app.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-auth.js";
    import {
      getFirestore, collection, addDoc, doc, deleteDoc,
      serverTimestamp, query, orderBy, onSnapshot
    } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDDTnOATqSbEWwleUOOq1dlGvv9NhFE3GU",
      authDomain: "krishdevlabs-signup.firebaseapp.com",
      projectId: "krishdevlabs-signup",
      storageBucket: "krishdevlabs-signup.appspot.com",
      messagingSenderId: "399199705494",
      appId: "1:399199705494:web:7551f84062f3b5a776e5b7"
    };
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
    let currentUser = null;

    onAuthStateChanged(auth, user => {
      if (user) {
        currentUser = user;
        loadQuestions();
      } else {
        window.location.href = "index.html";
      }
    });

    window.openModal = () => {
      document.getElementById("modalOverlay").classList.add("show");
    };
    window.closeModal = () => {
      document.getElementById("modalOverlay").classList.remove("show");
      document.getElementById("newQuestionInput").value = "";
    };

    window.postQuestion = async () => {
      const text = document.getElementById("newQuestionInput").value.trim();
      if (!text) return alert("Enter your question.");
      await addDoc(collection(db, "questions"), {
        question: text,
        uid: currentUser.uid,
        author: currentUser.displayName || currentUser.email,
        createdAt: serverTimestamp()
      });
      closeModal();
    };

    window.postAnswer = async (qid, inputId) => {
      const text = document.getElementById(inputId).value.trim();
      if (!text) return;
      await addDoc(collection(db, "questions", qid, "answers"), {
        answer: text,
        uid: currentUser.uid,
        author: currentUser.displayName || currentUser.email,
        createdAt: serverTimestamp()
      });
      document.getElementById(inputId).value = "";
    };

    window.toggleAnswers = (qid) => {
      const el = document.getElementById(`answers-${qid}`);
      el.style.display = el.style.display === "none" ? "block" : "none";
    };

    window.deleteQuestion = async (qid) => {
      if (confirm("Delete this question?")) {
        await deleteDoc(doc(db, "questions", qid));
      }
    };

    window.deleteAnswer = async (qid, aid) => {
      if (confirm("Delete this answer?")) {
        await deleteDoc(doc(db, "questions", qid, "answers", aid));
      }
    };

    async function loadQuestions() {
      const q = query(collection(db, "questions"), orderBy("createdAt", "desc"));
      onSnapshot(q, async (snapshot) => {
        const container = document.getElementById("questionsList");
        container.innerHTML = "";

        for (const docSnap of snapshot.docs) {
          const qid = docSnap.id;
          const data = docSnap.data();
          const time = data.createdAt?.toDate().toLocaleString() || '';

          const div = document.createElement("div");
          div.className = "question-card";
          div.innerHTML = `
            <div><strong>${data.question}</strong></div>
            <div class="meta">Posted by ${data.author} on ${time}</div>
            ${data.uid === currentUser.uid ? `<div class="actions">
              <button onclick="deleteQuestion('${qid}')">Delete</button>
            </div>` : ''}
            <div class="toggle" onclick="toggleAnswers('${qid}')">Show/Hide Answers</div>
            <div id="answers-${qid}" style="display:none;"></div>
            <div class="answer-form">
              <input id="input-${qid}" type="text" placeholder="Write an answer..." />
              <button onclick="postAnswer('${qid}', 'input-${qid}')">Post</button>
            </div>
          `;
          container.appendChild(div);
          loadAnswers(qid);
        }
      });
    }

    async function loadAnswers(qid) {
      const container = document.getElementById(`answers-${qid}`);
      const ref = query(collection(db, "questions", qid, "answers"), orderBy("createdAt"));
      onSnapshot(ref, (snapshot) => {
        container.innerHTML = "";
        if (snapshot.empty) {
          container.innerHTML = "<i>No answers yet.</i>";
          return;
        }
        snapshot.forEach(ans => {
          const a = ans.data();
          const aid = ans.id;
          const time = a.createdAt?.toDate().toLocaleString() || '';
          const div = document.createElement("div");
          div.className = "answer";
          div.innerHTML = `
            <div>${a.answer}</div>
            <div class="meta">by ${a.author} on ${time}</div>
            ${a.uid === currentUser.uid ? `<div class="actions">
              <button onclick="deleteAnswer('${qid}', '${aid}')">Delete</button>
            </div>` : ''}
          `;
          container.appendChild(div);
        });
      });
    }

    function toggleSidebar() {
      document.getElementById("sidebar").classList.add("open");
      document.getElementById("overlay").classList.add("show");
    }
    function closeSidebar() {
      document.getElementById("sidebar").classList.remove("open");
      document.getElementById("overlay").classList.remove("show");
    }
  </script>
  <script>
  function toggleSidebar() {
    document.getElementById("sidebar").classList.add("open");
    document.getElementById("overlay").classList.add("show");
  }

  function closeSidebar() {
    document.getElementById("sidebar").classList.remove("open");
    document.getElementById("overlay").classList.remove("show");
  }
</script>
</body>
</html>